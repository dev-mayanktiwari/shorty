#!/bin/sh
#
# Commit message hook to enforce conventional commit format
# Allowed formats:
#   feat: description
#   fix: description
#   docs: description
#   style: description
#   refactor: description
#   test: description
#   chore: description
#   perf: description
#   ci: description
#   build: description
#   revert: description
#

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Get commit message file
commit_msg_file="$1"

# Read commit message
commit_msg=$(cat "$commit_msg_file")

# Allowed conventional commit types
allowed_types="feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert"

# Pattern for conventional commits
# Format: type(scope): description
# or: type: description
# Also allows merge commits, revert commits, and release commits
pattern="^($allowed_types)(\(.+\))?: .+|^Merge .+|^Revert .+|^Release .+"

# Check if commit message matches pattern
if echo "$commit_msg" | grep -qE "$pattern"; then
    echo "${GREEN}✅ Commit message format is valid!${NC}"
    exit 0
else
    echo "${RED}❌ Invalid commit message format!${NC}"
    echo ""
    echo "${YELLOW}Commit message must follow conventional commit format:${NC}"
    echo "  ${GREEN}<type>: <description>${NC}"
    echo ""
    echo "${YELLOW}Allowed types:${NC}"
    echo "  ${GREEN}feat${NC}     - A new feature"
    echo "  ${GREEN}fix${NC}      - A bug fix"
    echo "  ${GREEN}docs${NC}     - Documentation only changes"
    echo "  ${GREEN}style${NC}    - Code style changes (formatting, etc.)"
    echo "  ${GREEN}refactor${NC} - Code refactoring"
    echo "  ${GREEN}test${NC}     - Adding or updating tests"
    echo "  ${GREEN}chore${NC}    - Maintenance tasks"
    echo "  ${GREEN}perf${NC}     - Performance improvements"
    echo "  ${GREEN}ci${NC}       - CI/CD changes"
    echo "  ${GREEN}build${NC}    - Build system changes"
    echo "  ${GREEN}revert${NC}   - Revert a previous commit"
    echo ""
    echo "${YELLOW}Examples:${NC}"
    echo "  ${GREEN}feat: add user authentication${NC}"
    echo "  ${GREEN}fix: resolve null pointer exception${NC}"
    echo "  ${GREEN}docs: update API documentation${NC}"
    echo "  ${GREEN}feat(auth): add JWT token validation${NC}"
    echo ""
    exit 1
fi

